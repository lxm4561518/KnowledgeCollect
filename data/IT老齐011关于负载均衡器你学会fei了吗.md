来源: B站
链接: https://www.bilibili.com/video/BV1rg411L7sg/?vd_source=65ed214bc3bc9271284d90d5a82986db

收人话中时战讲干或你好欢迎来到IT老奇的架构300讲我是老奇
如果觉得本节课的内容还不错
麻烦给点个赞点赞超过18个马上更新下一期
那今天咱们就来学习一下关于父母在军航器的知识
来了解一下到底什么是附在军航器
附在军航器又有哪些特点
以及这些附在军航器的内置策略又有什么
开始之前我非一句话
作为本资课程的所有核件
我已经都放到了公众号里边
大家可以进入公众号输入邮箱
就会获得这门课程的完整资料
架构300讲的所有内容都是公开免费的
下面咱们就进入正题
要解决三个问题
第一什么是附在军航器
第二附在军航器
有哪些类型
第三附在军航策略
有哪些
首先我们来看一下到底什么是附在军航器
不明思议
就是在我们多台服务器的前面
我们构建出一个附在军航的设备
可以让用户发来的请求
按照某一种方式来军员的将请求
分配给不同的服务器进行处理
这样就可以保证在后端的
我们具体的应用服务器
他们每一个几点的附在情况都是大致相同的
那么通过引入附在军航器
其实是解决了我们架构中的三个问题
第一个就是高可用性
比方说作为我们现在的TOMCAT
大家都知道TOMCAT是提供外部应用的地方
那么单台TOMCAT
它是没办法为我们系统提供高可用
因为它挂了
但是如果在前面
我们加一个附在军航器的话
连接多台TOMCAT
那这样它就可以为我们系统提供高可用
这台挂了还有其他的可以顶上
而第二个就是附在军航器的本质作用
它可以让我们后端的节点设备
压力处于一个相对平均的水平线上
而第三个就是支持故障发现与故障转移
在我们大多数的附在军航器下
它都会对后端的节点的状态来进行一个监控
比如定时发送一个新跳包
如果后端节点能够正常地将数据来进行返回的话
附在军航器就会认为
这个节点现在已经当机了
就会在当前可用的节点中将其摘除掉
这就是附在军航器
它能够提供故障发现与故障转移的底层原理所在
那么针对于附在军航器按照类别又可以分成两大类
第一种是按照软硬件来区分
可以分为硬件附在军航器和软件附在军航器
那么作为硬件附在军航
实际上就是一台专务专用的设备
最著名的就是美国的F5公司所研发的附在军航器
这种军航器它的性能是非常非常好的
因为专务专用有专门的内置的操作系统
有专门为其设置的软件
有专门的硬件的风装
所以是可以满足绝大多数企业及用用的要求
但是作为硬件附在军航器
你要付出一并的成本
就拿这个小盒子来说
我们在之前采购的时候
一个F5的附在军航器
大概最便宜的也得是十几万
贵的几十万上百万的都有
如果你在大公司预算充裕的情况下
可以考虑采购硬件附在军航器
那么如果我们是一家创意形的中小公司
它没有那么多的预算
这时就可以选择软件附在军航器了
所谓软件附在军航器
其实顾名思义就是一个软件
你把它装到某一台服务器
甚至是PC机上
那么它就可以起到从软件层面上的
附在军航的作用了
那么软件附在军航器是我们现在
在扎瓦领域应用的主流
因为它的成本相对于硬件附在军航器
确实要低很多
所以很多中小型公司会选择软件附在军航器
来使用
这是从软硬件的角度来说
那么如果从网络的层面上
它又可以分为四层代理和七层代理
那么什么是四层代理和七层代理
其实我们要回顾一下以前的网络的知识了
如果你最近一块不了解也没关系
大概听我说一下
你也能明白
首先作为我们网络有一个标准的七层模型
叫OSI七层模型
在OSI七层模型的标准下
从最底层的物理层到最上层的应用层
每一层其实都有各思其职的作用
那这里指的四层其实就指的传输层
最对应的协议
就是我们通常说的TCP协议
也就是我们互联网通信时的最底层的传输协议
叫做TCP协议
那么如果再往上到了第七层
就是应用层
应用层最典型的像我们常见的
这个STTP协议
FTP文件传输协议
还有SMTP
郵件服务发送的协议
这些都是七层应用
也就是说不从的层对应了不从的协议
那么越网上是越靠近我们具体应用的
那么针对于这种特性
在我们的负载均衡系里面
分别出现了四层代理和七层代理
变形的四层代理是在Linux系统中所存在的
也就是虚拟Linux服务器
作为IOS
它实际上是在TCP层面上
来实现的消息的代理和转发的工作
而这个七层代理
就指的是在应用层面上
针对于应用协议来进行的代理
比如说我们最常见的
STTP
进行外部开发时
可以使用七层代理
来进行消息转发和录油
那最变形的七层代理的软件
就是我们常用的Ngix了
那针对于四层代理和七层代理
这里我也给出了一个小小的比较
大家了解一下
作为四层代理
它是肯定相对底层
七层代理是相对更靠近应用层
首先从功能性上来说
四层代理
比如IOS
它只支持最基本的TCP的代理
以及我们进行最基础的轮循的
负载均衡工作
但是如果放在Ngix七层的代理上面
它就可以支持
比如说多种不同的负载均衡策略
向轮循全重IP哈西
UI哈西
它都是可以支持的
同时Ngix在进行反向代理的过程中
还可以对服务器的资源来进行一些压缩
和一些更有效的负加处理
这些都是在七层软
负载均衡器中走负语的额外特性
那么从执行效率上来说
肯定是越底层的执行效率就越高
就像我们平时开发时
会边语言的执行效率
肯定要比现在的渣娃或者购语言
来得要好
对不对
那从执行效率来说
七层的负载均衡相对执行较低
那作用的协议
四层对应了TCP或者UDP协议
而七层协议
则对应了HTDP FTP SMTP等等等等
这些应用协议
那作用场景
他们两者也有一个本质不同
作为应用场景下
首先因为效率高
自层的负载均衡器
通常会用在时时应用极群上
比如说大规模的消息的分发
或者进行应用的实时交流
在军事应用上用四层的会更多一些
因为它更要考虑实言性
还有就是在我们极群内部
来进行数据分发和消息传递的过程中
我们需要更高的传输效率
因此四层的负载均衡用了更多的
那与之对应的作为七层负载均衡器
更多的是用在我们最终的应用上
也就是企业及开发上
比如咱们要开发某一个外部应用程序
或者一个APP的后端应用
那显然用七层会更好
同时在做七层负载均衡的过程中
它还负语了额外的
比如资源压缩或者资源缓存
这样的更好的特性
这就是四层和七层
他们的一个对比
大家脑子里边有个数就行了
之后咱们再聊一个事情
就是在这个世界上用的
人数最多的一个软件负载均衡器
就是NGX
NGX它是一个轻量级的外保反向代理服务器
其中就内置了软件负载均衡器
那么针对于NGX在我们面试的时候
面试官可能会问你
请你列举几个NGX内置的负载均衡策略是什么
那这时负载均衡策略又有哪些呢
咱们来了解一下
作为NGX标准情况下
有五种负载均衡策略
这五种分别是伦循策略
全重策略
IPHC
UIHC和Fire
那么作为UIHC和Fire
它需要安装第三方的NGX模块才可以生效
请你把这几个名字记住
在面试的时候经常会被问到
那么为了能够让大家学习起来更加轻松
我画了一个图来讲解这五种负载均衡策略
首先咱们来看一个最简单的
也就是伦循策略
说人话就是排排做
吃锅锅
你一口
我一口
如果结合到刚才我们具体的应用
在我们后端他们开的积寻前面
挂在了NGX
那么第1个请求
会被送达给第1个接点
而第2个会被送达给第2个接点
第3个接点
又会被送达给第1个
这就是你一个我一个
大家呢
轮流来
那第2种策略
叫做全重策略
也称之为weight
比如说作为现在的两台他们开的服务器呢
这一台是八盒的普通的服务器
这一台是32盒的高性能服务器
那么像这种情况下
作为NGX
肯定再使用伦循就不合适了
因为这个性能强这个性能弱
我们要让32盒的这台服务器多做事情
怎么做呢
这时我们就可以为其设置一个全重数字
比如说我们设置70
而上面设置30
什么意思呢
也就是10个请求中
有7个请求
会被送达给第2个接点
而剩余的3个会被送达给第1个接点
这就是全重策略了
通过全重
可以让我们在这种性能不均衡的
他们还得急寻中
来让他有效的进行分配
而第3个叫做IP哈西
IP哈西叫做一个萝卜
一个坑
这个萝卜就指的是IP地址
来 再来看一下
假设通过NGX呢
在前面有一百格用户
那么作为这一百格用户
在访问NGX的时候
以IP地址作为规则
我们计算出一个数字
然后对2取模
为什么要对2取模呢
因为只有两个后台的他们开的节点吗
如果得到的结果是1的话
就固定的送达给第2个接点
那这也就意味着
这个IP只要没有变化的情况下
通过这个IP发来的请求
都会被转交给同一个他们开的节点
这就是IP哈西
IP哈西呢
在我们平时工作中不太建议使用
因为IP哈西
他无法保证我们后台服务节点的均衡
比如说有的IP地址
是用来进行数据导入
和数据的一些重量级的操作
而有些IP地址的用户请求
只是用于数据的基本查询
所以在长期系列后
不同节点下的他们开的
他的负载情况可能会出现巨大的差异
咱们再来说一个与之类似的叫
UAL哈西
一个白菜
一个坑
UAL哈西不再以IP为标准
而是以用户发来的请求的UAL地址
来进行取谋运算
比如说用户发来的一个图片
1.JPJ
那么经过哈西对2取谋以后
那么以后只要是访问
1.JPJ的UAL
都会被他们开的1来处理
那类似的2.JPJ
IP取谋以后
于数为1
那他永远就会被他们开他2来进行处理
那么通过UAL哈西
他的处理力度会更细
但是他也同样无法解决
这种负载不均衡的问题
而最后一个名为Fair
Fair是指你们谁显着出来挑奋去
Fair同样也是NGX三方模块需要支持的
作为Fair模块
他会定时的采用新跳包的机制
去看当前服务器的响应情况
如果这个服务器响应是属于低延迟的
说明这台服务器显制着
所以Fair就优先的把请求
送达给低延迟的他们开的服务器
这就是暗虚来进行处理
作为Fair模块
在我们平时使用并不多
大家了解一下就可以了
那么以上就是关于负载均衡的一些基础支持的讲解
希望能够对你有帮助
如果你觉得这些课对你有帮助
麻烦给我点个赞
谢谢大家